---
layout: post
category: JVM
description: 《深入Java虚拟机》的读书笔记
keywords: jvm
title: 类的生命周期
tags: [java, class, JVM]
summary: 类的生命周期
---

##类的生命周期

1.	装载
2.	连接（验证、准备、解析）
3.	初始化

类只有在被主动使用的时候才会初始化，主动初始化有6中情况：

1.	创建某个类的新实例。（new或者反射、反序列化等）
2.	调用某个类的静态方法。
3.	调用类或者接口的静态字段。final的静态字段除外，任何对final的静态字段引用都会直接被编译器优化成相应的值。
4.	使用反射
5.	初始化某个子类时，要求超类必须初始化。此规则不适用于接口：子接口初始化时，只有使用到父接口的非常量字段时，父接口才会初始化。	
6.	虚拟机启动时，被包含为启动类的类（即包含main方法的）。

###一.装载
1.	通过全限定类名，将class的二进制流装载
2.	产生方法区内部的数据结构
3.	生成Class类实例。

###二.连接
连接分为三个步骤：验证、准备、解析

* 验证：检查Class对象的字节码有效性；检查是否符合Java语义（比如final类不能有子类等）。
* 准备：为类变量分配内存，设置初始值。此处的初始值是指变量的原始初始值，而不是程序赋予的初始值。
* 解析：虚拟机可以推迟这一步。解析是将符号引用替换成直接引用。

###三.初始化
初始化是为类变量赋予正确的初始值。
所有的类变量初始化语句和静态初始化器都会被放在`<clinit>`方法里。


